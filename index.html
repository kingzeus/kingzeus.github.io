<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />










  <meta name="baidu-site-verification" content="cYyZ5DHnbQ" />













<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.4">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.4" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.0.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '1UY7BH2U27',
      apiKey: '55882b9ab4e6d1e2ccbf062c37243e95',
      indexName: 'kingzeus.github.io',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="��Ϸ,����,android,����" />


<meta name="description" content="游戏是可以SL的人生人生是没有NG的游戏">
<meta property="og:type" content="website">
<meta property="og:title" content="游戏 生活">
<meta property="og:url" content="http://kingzeus.github.io/index.html">
<meta property="og:site_name" content="游戏 生活">
<meta property="og:description" content="游戏是可以SL的人生人生是没有NG的游戏">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="游戏 生活">
<meta name="twitter:description" content="游戏是可以SL的人生人生是没有NG的游戏">



  <link rel="alternate" href="/atom.xml" title="游戏 生活" type="application/atom+xml" />




  <link rel="canonical" href="http://kingzeus.github.io/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>游戏 生活</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">游戏 生活</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">游戏是可以SL的人生，人生是没有NG的游戏</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签<span class="badge">17</span>
              </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类<span class="badge">6</span>
              </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档<span class="badge">6</span>
              </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kingzeus.github.io/2016/04/25/android-bottom-navigation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kingzeus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xqfqq.com1.z0.glb.clouddn.com/blog_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="游戏 生活">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/25/android-bottom-navigation/" itemprop="url">android 底部导航栏规范</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-25T14:09:21+08:00">2016-04-25</time>
            

            
            
              
            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">2.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">0:03</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>最后更新: 2016-04-27</li>
<li>修改记录:<ul>
<li>2016-04-25 初稿</li>
<li>2016-04-27 增加截图</li>
</ul>
</li>
</ul>
<hr>
<h1 id="0-前言："><a href="#0-前言：" class="headerlink" title="0. 前言："></a>0. 前言：</h1><p>最近 Google 在 Material Design 设计规范中加入底部导航栏（Bottom navigation）设计（参考文档: <a href="https://www.google.com/design/spec/components/bottom-navigation.html" target="_blank" rel="external">Components - Bottom navigation</a> ），现在我们先来学习 Bottom navigation 在设计、使用、交互、风格、尺寸的一些规范。水平有限，如理解有误，请多多吐槽。</p>
<p> <img src="/images/14615646982872.png" alt=""></p>
<h1 id="1-简单介绍"><a href="#1-简单介绍" class="headerlink" title="1. 简单介绍"></a>1. 简单介绍</h1><p>底部导航栏（Bottom navigation）这种设计最初是参考了 iOS 的设计规范，Google 在 Android 的设计规范上其实一直不推荐采用的。但是，很多 Android App 中都是随处可见的，如支付宝、微信、QQ等都使用了，它允许用户可以在多个顶级视图之间快速切换。</p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p> 底部导航栏推荐在手机上使用，平板或者桌面系统还是推荐侧边的导航栏</p>
<ul>
<li>移动设备<br><img src="/images/14617332106360.png" alt=""></li>
</ul>
<ul>
<li>较大显示设备，比如平板，桌面应用<br><img src="/images/14617332508427.png" alt=""></li>
</ul>
<h1 id="2-如何使用"><a href="#2-如何使用" class="headerlink" title="2. 如何使用"></a>2. 如何使用</h1><p>（1）底部导航栏需要有 3-5 个标签（tab）,并且每个tab选择的视图重要性要相似，对于少于 3个 tab 的情况，是不推荐使用 Bottom navigation 的。</p>
<ul>
<li>正确方式：<br><img src="/images/14615652601150.png" alt=""></li>
</ul>
<ul>
<li>错误方式：<br><img src="/images/14615652891922.png" alt=""></li>
</ul>
<p>（2）如果标签很多，比如有超过了 5 个这种情况呢？Google 也是不提倡使用 Bottom navigation 的，可以用 Drawer navigation 替换。</p>
<ul>
<li>正确方式：<br><img src="/images/14615653042210.png" alt=""></li>
</ul>
<ul>
<li>错误方式：<br><img src="/images/14615653215230.png" alt=""></li>
</ul>
<h1 id="3-风格样式"><a href="#3-风格样式" class="headerlink" title="3. 风格样式"></a>3. 风格样式</h1><p>（1）标签 Icons 和文字的颜色选择是很重要的，一亮一暗才能有对比，用户才很快知道你选择了哪个，如果五颜六色，你是很难分清选择了哪个的。</p>
<pre><code>* 当前标签是选中状态的时候，显示图标和文字。
* 当导航栏只有三个标签的时候，他们的图标和文字都应该被显示。
* 当导航栏有四个或者五个标签的时候，在非选中状态的时候只显示他们的图标即可。
* 导航栏选中的标签使用应用的主色来填充图标和文字
* 如果导航栏有背景色，使用白色来填充图标和文字
</code></pre><ul>
<li>正确方式：<br><img src="/images/14615653768533.png" alt=""></li>
</ul>
<p><img src="/images/14617350719576.png" alt=""></p>
<ul>
<li>错误方式：<br><img src="/images/14615653979084.png" alt=""></li>
</ul>
<p><img src="/images/14617350867144.png" alt=""></p>
<p> （2）标签的文字说明要简短而有意义，避免太长的，也不提倡太长了换行和省略的方式</p>
<ul>
<li>正确方式：<br><img src="/images/14615654161493.png" alt=""></li>
</ul>
<ul>
<li>错误方式：<br><img src="/images/14616016444449.png" alt=""></li>
</ul>
<p><img src="/images/14616016778061.png" alt=""></p>
<p> <img src="/images/14616017091194.png" alt=""></p>
<h2 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h2><ul>
<li><ol>
<li>选中的标签要展示高亮图标和文字</li>
</ol>
</li>
<li><ol>
<li>如果是3个标签的时候，要展示 Bottom navigation bar 中所有的图标和文字</li>
</ol>
</li>
<li><ol>
<li>如果是多于 3 个标签的情况，没选中的 tab 只需要展示图标就可以，不用文字说明</li>
</ol>
</li>
</ul>
<h1 id="4-行为交互"><a href="#4-行为交互" class="headerlink" title="4. 行为交互"></a>4. 行为交互</h1><p>（1）用户上拉列表时，隐藏Bottom navigation，下拉列表时，显示Bottom navigation<br><img src="/images/14616017631338.gif" alt=""></p>
<p>(2)点击Bottom navigation Icon 的时候，不能打开菜单选择或者其他弹窗操作，而只是刷新当前视图的内容，如下图：</p>
<p><img src="/images/14616017928800.gif" alt=""></p>
<p>(3)不推荐使用手势在视图内容区域切换视图</p>
<p>正确方式：<br><img src="/images/14616018078094.gif" alt=""></p>
<p>错误方式：<br><img src="/images/14616018251796.gif" alt=""></p>
<h1 id="5-固定风格导航栏尺寸设计"><a href="#5-固定风格导航栏尺寸设计" class="headerlink" title="5. 固定风格导航栏尺寸设计"></a>5. 固定风格导航栏尺寸设计</h1><p>（1）Bottom navigation对于尺寸的要求还是挺严格的，标签选中和没选中都有细微的差别。<br><img src="/images/14616018437232.png" alt=""></p>
<p>效果如下：</p>
<p><img src="/images/14616018655355.gif" alt=""></p>
<p>（2）具体的一些尺寸：</p>
<ul>
<li>最大宽度： 168 dp</li>
<li>最小宽度： 120 dp（大屏幕设备），104 dp（小屏幕设备）</li>
<li>高度： 56 dp</li>
<li>图标： 24*24 dp</li>
<li>内容对齐模式： 文字和图片水平居中</li>
<li>边距（padding）： <ul>
<li>选中的标签 ，图片上边距 6 dp；未选中标签，图片上边距 8 dp</li>
<li>文字下边距 10 dp</li>
<li>文字左右各 12 dp</li>
</ul>
</li>
<li>文字：<ul>
<li>选中标签 Roboto Regular 14sp</li>
<li>未选中标签 Roboto Regular 12sp</li>
</ul>
</li>
</ul>
<p>移动设备横屏效果<br>     <img src="/images/14617342550476.png" alt=""></p>
<p>平板效果<br><img src="/images/14617343097033.png" alt=""></p>
<h1 id="6-切换风格导航栏尺寸设计"><a href="#6-切换风格导航栏尺寸设计" class="headerlink" title="6. 切换风格导航栏尺寸设计"></a>6. 切换风格导航栏尺寸设计</h1><p>（1）选中和未选中的效果更明显<br><img src="/images/14617355603306.png" alt=""></p>
<p>效果:<br><img src="/images/14617377457930.gif" alt=""></p>
<p>(2) 尺寸规范:</p>
<ul>
<li>选中标签<ul>
<li>最大宽度：168 dp</li>
<li>最小宽度： 96 dp    </li>
</ul>
</li>
<li>未选中标签<ul>
<li>最大宽度： 96 dp</li>
<li>最小宽度： 64 dp</li>
</ul>
</li>
<li>高度： 56 dp</li>
<li>图标： 24*24 dp</li>
<li>内容对齐模式： 文字和图片水平居中</li>
<li>边距（padding）： <ul>
<li>选中的标签 ，图片上边距 6 dp；未选中标签，图片上边距 16 dp</li>
<li>下边距 10 dp</li>
</ul>
</li>
<li>文字：Roboto Regular 14sp</li>
</ul>
<p>移动设备横屏模式：<br><img src="/images/14617380707923.png" alt=""></p>
<p>平板模式：<br><img src="/images/14617380840138.png" alt=""></p>
<h1 id="7-杂谈"><a href="#7-杂谈" class="headerlink" title="7. 杂谈"></a>7. 杂谈</h1><p>Android官网中有这么一句话：</p>
<p><a href="http://developer.android.com/design/patterns/pure-android.html" target="_blank" rel="external">Don’t use bottom tab bars</a></p>
<p>Other platforms use the bottom tab bar to switch between the app’s views. Per platform convention, Android’s tabs for view control are shown in action bars at the top of the screen instead. In addition, Android apps may use a bottom bar to display actions on a split action bar.</p>
<p>You should follow this guideline to create a consistent experience with other apps on the Android platform and to avoid confusion between actions and view switching on Android.</p>
<p><img src="/images/14617351763741.png" alt=""></p>
<p>之前说好的Meterial Design 规范说变就变，自己都不遵守，有何规范可言。</p>
<p>Google+ 截图<br><img src="/images/14617385715582.jpg" alt=""></p>
<p>然而，Google +已经加入了底部导航栏（Bottom navigation），打脸归打脸，决定这一因素的还是用户。</p>
<p>我们说说 Drawer navigation，不要觉得疑惑，关 Drawer 什么事？没错，就是和它有关，认真想想，使用 Drawer 切换视图时，使用方式是点击按钮或者手势滑动打开，然后才选择跳转的标签，虽然节省了手机视图空间，但是操作较不方便以致使用率低，从而降低其他页面的跳转率这个缺点是不能忽视的。<br>所以说，相对于 Drawer navigation , Bottom navigation 就有优势了。</p>
<p>然后，对于我们开发来说，又是一大难点了。</p>
<p>比如 FB、SnackBar 等显示的方式，个人觉得都可以不需要 FB 了，至于SnackBar，看下图：</p>
<p><img src="/images/14617352823186.png" alt=""></p>
<p>这这这，原谅我欣赏不了这种美。</p>
<h1 id="总结：被坑的最惨的还是-Android-程序员！"><a href="#总结：被坑的最惨的还是-Android-程序员！" class="headerlink" title="总结：被坑的最惨的还是 Android 程序员！"></a>总结：被坑的最惨的还是 Android 程序员！</h1>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kingzeus.github.io/2016/04/13/android-view-touchevent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kingzeus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xqfqq.com1.z0.glb.clouddn.com/blog_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="游戏 生活">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/13/android-view-touchevent/" itemprop="url">Android View 的事件机制详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-13T20:25:52+08:00">2016-04-13</time>
            

            
            
              
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">3.9k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">0:04</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>最后更新: 2016-04-13</li>
<li>修改记录:<ul>
<li>2014-04-13 初稿</li>
<li>2014-04-18 补充示例</li>
</ul>
</li>
</ul>
<h2 id="1-View-事件分发机制"><a href="#1-View-事件分发机制" class="headerlink" title="1. View 事件分发机制"></a>1. View 事件分发机制</h2><p>View 是 Android UI 的一个基础，而事件分发机制是 View 的一个核心知识点更是一个难点，很多同学对这个问题都会比较困惑。而 View 的另一个难点滑动冲突的解决也依赖于事件分发机制。</p>
<h3 id="1-1-MotionEvent"><a href="#1-1-MotionEvent" class="headerlink" title="1.1 MotionEvent"></a>1.1 MotionEvent</h3><p>MotionEvent 用来描述用户触发的屏幕动作的事件。</p>
<p>当你的一个手指在屏幕上滑动一下时，系统会产生一系列的触摸事件对象。典型的事件包括：</p>
<ul>
<li><strong>ACTION_DOWN</strong> = 0 —— 手指触摸到屏幕</li>
<li><strong>ACTION_UP</strong> = 1 —— 手指从屏幕上移开</li>
<li><strong>ACTION_MOVE</strong> = 2 —— 手指在屏幕上移动</li>
<li><strong>ACTION_CANCEL</strong> = 3 —— 动作取消</li>
<li><strong>ACTION_OUTSIDE</strong> = 4 —— 动作超出边界</li>
<li><strong>ACTION_POINTER_DOWN</strong> = 5 —— 已有一个点被按住，再按下另外一个点</li>
<li><strong>ACTION_POINTER_UP</strong> = 6 —— 多点被按下的时候，非最后一个点抬起</li>
</ul>
<p><img src="/images/14605560667360.gif" alt=""></p>
<p>正常情况下，一次手指触摸屏幕可能产生的事件：</p>
<ul>
<li>按下后直接松开  序列为： DOWN -&gt; UP</li>
<li>按下后移动一阵之后在松开 序列为： DOWN -&gt; MOVE … -&gt; MOVE -&gt; UP</li>
</ul>
<p>同时我们可以通过 MotionEvent 得到点击的 坐标。为此，提供了 2组 函数 <code>getX/getY</code> 和 <code>getRawX/getRawY</code> 。区别在于：</p>
<ul>
<li><code>getX/getY</code> 返回相对于当前 View 左上角的坐标</li>
<li><code>getRawX/getRawY</code> 返回相当于屏幕左上角的坐标</li>
</ul>
<h3 id="1-2-TouchSlop"><a href="#1-2-TouchSlop" class="headerlink" title="1.2 TouchSlop"></a>1.2 TouchSlop</h3><p>TouchSlop 是系统能识别出来的被认为是滑动的最小距离。也就是说，手指在屏幕上滑动时，如果两次滑动的距离小于这个常量，那么就不会被识别成滑动。</p>
<p>TouchSlop 可以用来防止按键位置的抖动。这个常量是设备相关的，可以通过 <code>ViewConfiguration.getScaledTouchSlop()</code> 来获取。</p>
<h2 id="2-点击事件的相关处理函数"><a href="#2-点击事件的相关处理函数" class="headerlink" title="2. 点击事件的相关处理函数"></a>2. 点击事件的相关处理函数</h2><p>一个点击事件 (MotionEvent) 产生以后，系统需要把这个事件传递给一个具体的 View，而这个传递的过程就是事件的分发过程。点击事件的分发过程由 3 个方法来共同完成：</p>
<ul>
<li>public boolean dispatchTouchEvent (MotionEvent ev)</li>
</ul>
<p>用来进行事件分发。如果事件能够传递给当前的 View ，那么这个方法就一定会被调用，返回结果受当前 View 的 onTouchEvent 和 子 View 的 <code>dispatchTouchEvent</code> 的影响。返回事件是否被消费。</p>
<ul>
<li>public boolean onInterceptTouchEvent (MotionEvent ev)</li>
</ul>
<p>在 <code>dispatchTouchEvent</code> 内部调用，用来判断是否拦截某个事件。返回是否拦截事件。</p>
<ul>
<li>public boolean onTouchEvent(MotionEvent ev)</li>
</ul>
<p>在 <code>dispatchTouchEvent</code> 内部调用，用来处理点击事件，返回结果表示是否消费了当前事件。</p>
<h2 id="3-举个栗子"><a href="#3-举个栗子" class="headerlink" title="3. 举个栗子"></a>3. 举个栗子</h2><ul>
<li>下面是一个自定义的 Activity</li>
</ul>
<p><img src="/images/14609483250389.png" alt=""></p>
<ul>
<li>布局简略关系</li>
</ul>
<p><img src="/images/14609484458874.png" alt=""></p>
<ul>
<li>事件分发</li>
</ul>
<p>下图显示了，没有拦截时候的事件分发顺序</p>
<pre><code>手指在 View1 上操作时事件分发顺序
当按下事件没有被拦截，那么所有状态的事件都由Activity进行处理
</code></pre><p><img src="/images/14609487247618.png" alt=""></p>
<ul>
<li><p>事件消费<br>通过 dispatchTouchEvent 对事件进行处理，当返回值为 true 的时候表示消费了事件。</p>
<pre><code>ViewGroup1 中的 dispatchTouchEvent 直接返回 true
手指在 View1 上操作时事件分发顺序
事件传递到 ViewGroup1 后被消费，后续事件没有分发给子控件
</code></pre></li>
</ul>
<p><img src="/images/14609490327325.png" alt=""></p>
<ul>
<li><p>事件拦截<br>通过 onInterceptTouchEvent 拦截事件，当返回值为 true 的时候拦截事件</p>
<pre><code>ViewGroup2 中的 onInterceptTouchEvent 直接返回 true
手指在 View1 上操作时事件分发顺序
事件传递到 ViewGroup2 后被拦截，不会再分发给子控件
</code></pre></li>
</ul>
<p><img src="/images/14609602211963.png" alt=""></p>
<ul>
<li><p>事件处理<br>当 onTouchEvent 返回 true ，表示事件被当前控件消费</p>
<pre><code>ViewGroup2 中的 onInterceptTouchEvent 直接返回 true
  ViewGroup2 中的 onTouchEvent 方法中添加 按下事件 返回 true
当手指对View1点击、移动、抬起时
事件传递到 ViewGroup2 后被拦截，后续事件先发送给 ViewGroup2 处理，然后返回 Activity 处理
</code></pre></li>
</ul>
<p><img src="/images/14609607629304.png" alt=""></p>
<pre><code>ViewGroup2 中的 onInterceptTouchEvent 直接返回 true
  ViewGroup2 中的 onTouchEvent 方法中 直接返回 true
当手指对View1点击、移动、抬起时
事件传递到 ViewGroup2 后被拦截，后续事件全部由 ViewGroup2 处理
</code></pre><p><img src="/images/14609608813851.png" alt=""></p>
<ul>
<li><p>下面来看下 button 的处理</p>
<pre><code>用 Button1 替换 View1
其余函数使用默认实现
button 默认就是直接截获和消费了事件
</code></pre></li>
</ul>
<p><img src="/images/14609611313192.png" alt=""></p>
<pre><code>View 的 *clickable* 属性的效果，就如同 button 一样。
</code></pre><h2 id="4-dispatchTouchEvent-伪代码"><a href="#4-dispatchTouchEvent-伪代码" class="headerlink" title="4. dispatchTouchEvent 伪代码"></a>4. dispatchTouchEvent 伪代码</h2><p><img src="/images/14609640887128.jpg" alt=""></p>
<ul>
<li>对于一个根 ViewGroup 来说，点击事件产生以后，会首先传递给它，此时 它的 dispatchTouchEvent 就会被调用</li>
<li>如果这个 ViewGroup 的 onInterceptTouchEvent 返回 true 就表示它要拦截事件，那么接下去的事件都会由这个 ViewGroup 处理，即 onTouchEvent 会被调用</li>
<li>如果这个 ViewGroup 的 onInterceptTouchEvent 返回 false 就表示它不会拦截事件，当前事件就会传递给子控件，接着调用子控件的  dispatchTouchEvent</li>
<li>如此反复直到事件被最终处理</li>
<li>当一个 View 需要处理事件时，如果设置了 onTouchListener，则优先处理 onTouchListener 的 onTouch 事件，根据 onTouch 的返回值，来决定 onTouchEvent 是否被调用（true 表示消费了事件，不会再调用了 onTouchEvent）。如果设置了 onClickListener ，则会在 onTouchEvent 中被调用。</li>
<li>如果 View 的 onTouchEvent 返回 false，即没有消费事件，就会调用父控件的 obTouchEvent ，直到 Activity 的 obTouchEvent。</li>
</ul>
<h2 id="5-事件传递机制的结论"><a href="#5-事件传递机制的结论" class="headerlink" title="5. 事件传递机制的结论"></a>5. 事件传递机制的结论</h2><ol>
<li>同一个事件序列是指从手指接触屏幕的那一刻开始，直到手指离开屏幕的那一刻结束。在这个过程中产生了一系列的事件合集。这个事件序列从 DOWN 开始，中间含有数量不等的 MOVE 事件，最终以 UP 事件结束。</li>
<li>正常情况下，一个事件序列只能被一个 View 拦截且消耗。</li>
<li>某个 View 一旦决定拦截事件，那么这个事件序列都由它来处理，并且它的 onInterceptTouchEvent 不会再被调用，即后续事件不会再去询问是否要拦截。</li>
<li>某个 View 一旦开始处理事件，如果它不消费 ACTION_DOWN 事件(onTouchEvent 返回 false)，则后续的事件不会交给它来处理，事件会交由它的父控件来处理（父控件的 onTouchEvent 会被调用）。</li>
<li>如果 View 不消费除 ACTION_DOWN 以外的事件，那么这个点击事件会消失，此时父控件的 onTouchEvent 并不会被调用，并且当前 View 能收到后续事件，最终这些事件会交由 Activity 来处理。</li>
<li>ViewGroup 默认不拦截事件，onInterceptTouchEvent 默认返回 false。</li>
<li>View 没有 onInterceptTouchEvent ，一旦有事件到达，那么 onTouchEvent 就会被调用。</li>
<li>View 默认会消费事件，即 onTouchEvent 返回 true，除非它是不可点击（clickable 和 longClickable 同时为 false），其中 longClickable 默认为 false；clickable 则需要根据控件讨论，button 默认返回 true；textView 默认返回 false</li>
<li>View 的 enable 属性不影响 onTouchEvent 的默认返回值。</li>
<li>onClick 发生的前提是当前 View 可点击，且收到了 down 和 up 事件。</li>
<li>事件传递总是从父控件传递到子控件，子控件可以通过 requestDisallowInterceptTouchEvent 来干预父控件的事件分发，但是 ACTION_DOWN 除外。</li>
</ol>
<h2 id="6-参考"><a href="#6-参考" class="headerlink" title="6. 参考"></a>6. 参考</h2><ul>
<li><a href="http://p.codekk.com/blogs/detail/54cfab086c4761e5001b253e" target="_blank" rel="external">公共技术点之 View 事件传递</a></li>
<li><a href="http://www.jianshu.com/p/49d4043621d6" target="_blank" rel="external">View的事件分发机制</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kingzeus.github.io/2016/03/31/hexo-cdn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kingzeus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xqfqq.com1.z0.glb.clouddn.com/blog_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="游戏 生活">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/31/hexo-cdn/" itemprop="url">hexo 的 cdn 加速</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-31T15:21:08+08:00">2016-03-31</time>
            

            
            
              
                
              
            

            
              
              <span class="post-meta-divider">|</span>
              

              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2016-04-10T20:40:00+08:00">2016-04-10</time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/hexo/" itemprop="url" rel="index"><span itemprop="name">hexo</span></a></span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/hexo/博客/" itemprop="url" rel="index"><span itemprop="name">博客</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">2.3k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">0:02</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>最后更新: 2016-03-31</li>
<li>修改记录:<ul>
<li>2014-03-31 初稿</li>
<li>2014-04-10 增加效果对比</li>
</ul>
</li>
</ul>
<p>最近用 hexo 搞了个博客，非常好用。不过，作为不折腾不舒服斯基，还是有很多可以瞎折腾的。</p>
<h2 id="为啥要加速"><a href="#为啥要加速" class="headerlink" title="为啥要加速"></a>为啥要加速</h2><ol>
<li>目前的博客是依托于 github 的 pages 的，所以，页面访问速度不甚理想，图片的访问更甚。</li>
<li>另外，使用了 Next 的主题，里面使用了谷歌的字体，基于某种神秘的力量，天朝无法正常访问。</li>
<li>博客页面使用了很多第三方的开源库，这些 css 或者 js 位于世界的各个角落，所以访问速度也是各不相同。</li>
</ol>
<p>总的一句话，页面呈现的速度太慢，需要优化。</p>
<h2 id="啥是-CDN"><a href="#啥是-CDN" class="headerlink" title="啥是 CDN"></a>啥是 CDN</h2><pre><code>内容分发网络（Content delivery network或Content distribution network，缩写：CDN）是指一种通过互联网互相连接的电脑网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户，来提供高性能、可扩展性及低成本的网络内容传递给用户。
                    --来自 不存在的百科网站
</code></pre><p><img src="/images/14594892390920.jpg" alt=""></p>
<p>左边的是单服务器模式，右边的就是 CDN 模式</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>废话不多说，直接上方法。</p>
<h3 id="主题的-CDN-静态文件加速"><a href="#主题的-CDN-静态文件加速" class="headerlink" title="主题的 CDN 静态文件加速"></a>主题的 CDN 静态文件加速</h3><p>主要使用 cdn 来加速主题中使用的前端库。目前我使用的是 next 主题，就拿这个主题动手，其他的主题也是类似，可以参照修改。</p>
<h4 id="国内常用的-CDN-服务"><a href="#国内常用的-CDN-服务" class="headerlink" title="国内常用的 CDN 服务"></a>国内常用的 CDN 服务</h4><p><img src="/images/14594917399605.jpg" alt=""></p>
<h5 id="1-百度CDN公共库"><a href="#1-百度CDN公共库" class="headerlink" title="1. 百度CDN公共库"></a>1. 百度CDN公共库</h5><p>百度公共CDN为站长的应用程序提供稳定、可靠、高速的服务，包含全球所有最流行的开源JavaScript库。</p>
<ul>
<li><a href="http://cdn.code.baidu.com/" target="_blank" rel="external">官网：http://cdn.code.baidu.com/</a></li>
</ul>
<h5 id="2-360网站卫士"><a href="#2-360网站卫士" class="headerlink" title="2. 360网站卫士"></a>2. 360网站卫士</h5><p>提供了由360网站卫士CDN驱动的常用前端公共库以及和谐使用Google公共库&amp;字体库的调用方法</p>
<ul>
<li><a href="http://libs.useso.com/" target="_blank" rel="external">官网：http://libs.useso.com/</a></li>
</ul>
<h5 id="3-BootCDN"><a href="#3-BootCDN" class="headerlink" title="3. BootCDN"></a>3. BootCDN</h5><p>稳定、快速、免费的开源项目 CDN 服务</p>
<ul>
<li><a href="http://www.bootcdn.cn" target="_blank" rel="external">官网：http://www.bootcdn.cn</a></li>
</ul>
<h5 id="4-又拍云"><a href="#4-又拍云" class="headerlink" title="4. 又拍云"></a>4. 又拍云</h5><ul>
<li><a href="http://jscdn.upai.com/" target="_blank" rel="external">官网：http://jscdn.upai.com/</a></li>
</ul>
<h5 id="5-七牛"><a href="#5-七牛" class="headerlink" title="5. 七牛"></a>5. 七牛</h5><ul>
<li><a href="http://jscdn.upai.com/" target="_blank" rel="external">官网: http://jscdn.upai.com/</a></li>
</ul>
<h5 id="6-新浪云"><a href="#6-新浪云" class="headerlink" title="6. 新浪云"></a>6. 新浪云</h5><p>新浪云计算是新浪研发中心下属的部门，主要负责新浪在云计算领域的战略规划，技术研发和平台运营工作。主要产品包括 应用云平台Sina App Engine（简称SAE）。</p>
<p>SAE的CDN节点覆盖全国各大城市的多路（电信、联通、移动、教育）骨干网络，使开发者能够方便的使用高质量的CDN服务。</p>
<ul>
<li><a href="http://lib.sinaapp.com/" target="_blank" rel="external">官网: http://lib.sinaapp.com/</a></li>
</ul>
<h4 id="增加主题配置"><a href="#增加主题配置" class="headerlink" title="增加主题配置"></a>增加主题配置</h4><p>在主题的配置文件 <code>_config.yml</code> 中增加 CDN 配置:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cdn</span></div><div class="line"><span class="attr">cdn:</span></div><div class="line"><span class="attr">  enable:</span> <span class="literal">true</span></div><div class="line"><span class="comment"># bootcdn support: font-awesome,fancybox</span></div><div class="line"><span class="attr">  server:</span> <span class="string">bootcdn</span></div><div class="line"><span class="comment"># 360cdn support:font_lato,fancybox,font-awesome(only 4.2.0)</span></div><div class="line"><span class="comment"># server: 360cdn</span></div></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li>==cdn.enable== 控制是否启用 CDN</li>
<li>==cdn.server== 定义了使用的 CDN 服务商</li>
</ul>
<h4 id="文件修改"><a href="#文件修改" class="headerlink" title="文件修改"></a>文件修改</h4><p>修改 <code>head.swig</code>，目录是：<img src="/images/14602867734715.jpg" alt=""></p>
<p>根据上面的参数，设置下对应的地址就可以了。修改完的代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;% if theme.fancybox %&#125;</div><div class="line">  &#123;% if theme.cdn.enable %&#125;</div><div class="line">    &#123;% if theme.cdn.server == "360cdn" %&#125;</div><div class="line">      <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://libs.useso.com/js/fancybox/2.1.5/jquery.fancybox.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>/&gt;</span></div><div class="line">    &#123;% elif theme.cdn.server == "bootcdn" %&#125;</div><div class="line">      <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>/&gt;</span></div><div class="line">    &#123;% endif %&#125;  </div><div class="line">  &#123;% else %&#125;  </div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; url_for(theme.vendors) &#125;&#125;/fancybox/source/jquery.fancybox.css?v=2.1.5"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>/&gt;</span></div><div class="line">  &#123;% endif %&#125;</div><div class="line">&#123;% endif %&#125;</div></pre></td></tr></table></figure></p>
<p>其他的代码也类似。</p>
<h3 id="博客内容的-CDN-加速"><a href="#博客内容的-CDN-加速" class="headerlink" title="博客内容的 CDN 加速"></a>博客内容的 CDN 加速</h3><p>主要是使用 cdn 来加速博客文章中使用的图片</p>
<h4 id="使用七牛云存储来加速图片"><a href="#使用七牛云存储来加速图片" class="headerlink" title="使用七牛云存储来加速图片"></a>使用七牛云存储来加速图片</h4><ul>
<li>登录七牛网站，上传图片</li>
<li>复制图片的外链，替换对应图片</li>
</ul>
<h2 id="效果对比"><a href="#效果对比" class="headerlink" title="效果对比"></a>效果对比</h2><p>使用 cdn 之前<br><img src="/images/14602916261355.jpg" alt=""></p>
<p>使用 CDN 之后<br><img src="/images/14602916431704.jpg" alt=""></p>
<ul>
<li>bg.jpg 加载时间从 4.17 秒减到了 264.7 毫秒 ( 文件越大,效果越明显)</li>
</ul>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>使用了 CDN 可以明显改善访问速度，但是博客页面本身访问还是存在一定问题的，github 网站也有可能 短时间或者永久的 “不存在”，接下来，会说说如何增加国内的镜像。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kingzeus.github.io/2016/03/19/my-blog-times/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kingzeus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xqfqq.com1.z0.glb.clouddn.com/blog_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="游戏 生活">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/19/my-blog-times/" itemprop="url">我的博客时代</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-19T14:11:49+08:00">2016-03-19</time>
            

            
            
              
            

            
              
              <span class="post-meta-divider">|</span>
              

              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2016-03-19T14:11:49+08:00">2016-03-19</time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/博客/" itemprop="url" rel="index"><span itemprop="name">博客</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">5.1k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">0:05</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>算起来，我是从2006年左右开始在 MSN 空间上写博客的（2005年为博客元年），那几乎是博客最辉煌的时代，随着 MSN 空间的关闭，那段时间写的内容都已经找不回来了。</p>
<p>后来，又陆续折腾过好多的博客空间，还自己买过主机，搭过 wordpress。断断续续的写过不少内容，不过最后也都慢慢的归于沉寂。</p>
<p>最近，我又立了 Flag，重新搭了博客，开始写东西了。这一两年随着微博、微信和公众号的兴起，总有人在说博客已死，但是，我觉得一个真正想要去书写文字的人根本不会在乎博客是不是死了，甚至于根本不在意博客本身，他们只会关心自己接下来写什么，是不是还要继续写下去。博客只是一个平台，写作也只是个手段，留下来的内容才是目的，有没有人看，有没有人评论也没有什么关系，重要的是自己在书写文字，写作本身就是意义。</p>
<p>虽然我很晚才知道这一点，但是我仍然很庆幸。</p>
<h3 id="前博客时代-2006-2009"><a href="#前博客时代-2006-2009" class="headerlink" title="前博客时代 (2006-2009)"></a>前博客时代 (2006-2009)</h3><p>这段时间是博客最辉煌的时代，当初我也迷茫地在很多个网站上开过博客：</p>
<ul>
<li><strong>blogspot</strong>：曾经叫Blogger，全球最大，现被墙。</li>
<li><strong>blogcn</strong>：中国当时很火的博客社区，跟后来的新浪博客相呼应，新浪博客名人扎堆，blogcn草根多多。</li>
<li><strong>wordpress</strong>：很多独立博客都是用wordpress搭建的，不仅是工具，还是平台，现被墙。</li>
<li><strong>QQ空间</strong>：每人都有一个QQ号，每个人都有一个QQ空间，你必须承认这一点。</li>
<li><strong>百度空间</strong>：百度出过IM，叫百度HI，你造吗？百度空间那时也火了一阵。</li>
<li><strong>MSN space</strong>：在2005年有一个MSN Space是很牛叉的。现在MSN Space关了，将用户都倒进了新浪博客。</li>
<li><strong>博客巴士</strong>：博客巴士是当时做得挺不错的专业博客站点，不过博客大潮一过就消失得差不多了。</li>
<li><strong>牛博网</strong>：博客界的一朵奇葩，罗永浩创办，想打造一流的言论平台，但后因政治内容被墙，接着罗永浩挥刀自宫，搞了一个无政治内容的“嫣牛博”，阉了也活不了，最后被迫关闭。老罗后来搞英语培训，现在搞手机。</li>
<li><p><strong>新浪博客</strong>：新浪博客是新浪在2005年转型的成功之作，搞了「明星政策」邀请了一大堆的名人开博，一时风头无两，什么名人都要开个博客才算是顺应了互联网潮流。</p>
<p>那几年也出现了大批的独立博客：</p>
</li>
<li>和菜头：槽边往事</li>
<li>洪波：牛乱弹琴</li>
<li>William Long：月光博客</li>
<li>小众软件：Scavin</li>
<li>It Talks：魏武挥的blog</li>
<li>Jason Ng：可能吧</li>
<li>萧秋水：逍遥游</li>
<li>爱范儿</li>
<li>善用佳软</li>
<li>望月的博客</li>
<li><p>……</p>
<p>博客时代到来，信息量暴增，如果处理这些博客的信息成了一个问题。</p>
</li>
</ul>
<h3 id="后博客时代"><a href="#后博客时代" class="headerlink" title="后博客时代"></a>后博客时代</h3><p>到2009年，微博顺利地接替了青黄不接的博客，微博如火如荼地扩张起来，信息变得的碎片化，也有公司留意到了这一点，一种介乎于博客与微博的所谓「轻博客」应运而生，始祖就是2007年的Tumblr，随后，国内出现了点点网和LOFTER，但是轻博客的发展并不如当初的博客和微博，不温不火，一直徘徊在边缘地带，进入不了大众市场。</p>
<p>到2012年，Twitter的老大出来搞了一个Medium，博客似乎又开始以另外的一种形式回归到大众的眼前，随后国内的有了简书和十五言这样的写作平台，目的就是让人开始从信息碎片时代回归到自己的内心。这就是后博客时代，微博的热闹变成了喧嚣，人们从关注社会新闻明星动态到关心自我成长，各种信息形态的变化最终也离不开内容的创造，思想不停地汇集分散，文字在各种平台上流淌，最终还会归结到各自的内心中。</p>
<p>前博客时代的人倾向于功利，希望被关注，希望被喜欢，独立博客不断地寻求SEO，各种的优化，而后博客时代的人专注于内心与分享，不哗众取宠，不争名夺利，默默地前进。吹尽黄沙始到金，热潮会退去，博客只属于一部分人。但是，博客终不会消失，只要人存在，它就会一直存在。</p>
<h2 id="为什么你要写博客"><a href="#为什么你要写博客" class="headerlink" title="为什么你要写博客"></a>为什么你要写博客</h2><h3 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h3><p>我知道现在可能说这话已经不合时宜，毕竟博客时代都已经过去了，现在流行的是碎片化的知识分享。再号召大家用过时的东西是不是有点逆流而上？</p>
<p>我曾经也问过自己这个问题，但是我觉得，博客时代过去跟我们要写博客是没有多大关系的，就好像你的读书时代已经过去你就不再读书一样。</p>
<p>判断一件事情值不值得去做有一个方法：拿出一张白纸，在左边写不值得做的原因，然后在右边写值得做的原因，写完一比较，一权衡，自然能够得出结果。</p>
<p>所以，我在这里列出要写（独立）博客的原因，供大家去选择，然后填在你白纸的右边。这不是一个建议，而是一个选择，这个选择蕴藏着我也不知道的可能。</p>
<h3 id="博客的内容"><a href="#博客的内容" class="headerlink" title="博客的内容"></a>博客的内容</h3><p>写博客不难，你可以当作是生活的记录，这样的记录不能说没有意义，但是对你的帮助也仅限于回忆而已。文字的意义在于，书写出来的东西是思考的结果，一篇文字可以把当时你的所思所想完整的展现出来。</p>
<p>我认为要开一个博客，博客的内容应该是这样的：</p>
<ol>
<li>不是流水账、不牢骚、不抱怨……；</li>
<li>有目的地写，要务实，追求质量；</li>
<li>承认真实的自己，不要吹嘘，不要装逼，也无需讨好读者；</li>
<li>记录自己学习、思考、总结的过程；</li>
<li>分享你的故事、所得、感想、经验；</li>
</ol>
<h3 id="值得去写的原因"><a href="#值得去写的原因" class="headerlink" title="值得去写的原因"></a>值得去写的原因</h3><h4 id="1-重新认识自己"><a href="#1-重新认识自己" class="headerlink" title="1. 重新认识自己"></a>1. 重新认识自己</h4><p>是不是很久没有跟自己对话了？我什么时候开始变得这样了？……</p>
<p>你可以尝试从回答一些问题开始，将你过去要回避的问题写下来，例如就可以从这个九个问题开始：</p>
<ol>
<li>请你介绍一下你自己，你是个什么样的人？</li>
<li>你有什么理想吗？这个理想是怎么形成的？</li>
<li>你理想的伴侣关系是什么样的？你自己在这个伴侣关系中扮演什么样的角色？要承担什么样的责任？</li>
<li>你理想的事业是什么，你正在做的工作符合你的事业理想吗？这份工作对你的意义是什么？</li>
<li>你对亲子关系怎么看？对你来说，什么是一个理想的父亲（母亲），你期望自己成为这样一个理想父亲（母亲）吗？</li>
<li>你对钱怎么看，你认为赚到多少钱是足够的？如果你明天一早醒来，已经有足够的钱，你将会如何继续安排自己的生活？</li>
<li>对你来说，什么是理想的性生活？什么是理想的性道德，在你的性道德观中，什么样的性生活是禁忌的，需要避免的，什么样的性生活是美好的，需要得到鼓励和发展的？</li>
<li>你的择友标准是什么？什么样的人你会愿意交往，什么样的人你会拒绝和他交往？</li>
<li>你对死亡怎么看？你希望自己活到多少岁，你准备怎么度过从现在到死亡的这段时间？如果你要立遗嘱，这份遗嘱会怎么写？</li>
</ol>
<p>以上的这九个问题摘自《很少人能顺畅回答这9个问题——心理治疗刚开始医生常常会先问你的 》by 李孟潮。</p>
<p>这些问题的答案你可以选择不公开，但是我强烈地建议写下来，只有在写的时候你才可以慎重地思考这些问题，而不会回避跳过或者留下空白，这是接受自己的第一步。</p>
<h4 id="2-提供持续学习的动力"><a href="#2-提供持续学习的动力" class="headerlink" title="2. 提供持续学习的动力"></a>2. 提供持续学习的动力</h4><p>我为自己设限每天写一些技术总结，信息的不断输出给我带来恐惧，我害怕有一天我写无可写，于是我不停地阅读，通过个人的知识管理促使自己不断学习，提高核心竞争力。</p>
<h4 id="3-积累更多的知识"><a href="#3-积累更多的知识" class="headerlink" title="3. 积累更多的知识"></a>3. 积累更多的知识</h4><p>博客并不是单纯的输出文字。</p>
<p>常常写着写着，你突然忘记了一个概念，于是各种谷歌百度，找回来这个概念的时候，你重温这个概念，可能还会顺便看了一下这个概念的其他东西。书写本身可以帮你更好的梳理知识，积累知识。</p>
<p>需要获取第一手的资料，寻找信息来源本身就是一个知识积累的过程，同时，你慢慢就学会了鉴别知识：什么是没有用的心灵鸡汤，什么是不值得关注的，还有，在这个过程中，你还养成你的心智。</p>
<h4 id="4-提高将事情讲清楚的能力"><a href="#4-提高将事情讲清楚的能力" class="headerlink" title="4. 提高将事情讲清楚的能力"></a>4. 提高将事情讲清楚的能力</h4><p>很多东西你以为懂了，但当你要写下来的时候，你就觉得无从下手了。</p>
<pre><code>如果一件事情你不能讲清楚，十有八九你还没有完全理解。
</code></pre><p>将事情写下来，慢慢就可以提高你的逻辑思维能力，分析能力，写会迫使你在你脑中搭建一个有条理的框架。就像我写这篇文章一样，我将值得写博客的原因一点一点地罗列出来，事情就更加清晰，你也可以更好的思考问题。</p>
<h4 id="5-分享带来的连锁反应"><a href="#5-分享带来的连锁反应" class="headerlink" title="5. 分享带来的连锁反应"></a>5. 分享带来的连锁反应</h4><pre><code>“通过分享，你获得了直接而快速的回报，你最终或许会发现你已将版权和“保留所有权利”抛诸脑后。新的经济学准则是：参与你作品的人越多，回报越高。在分享主义里，如果你愿意你可以保留所有权，但是我乐于分享。” by 毛向辉 《分享主义：一场思维革命》
</code></pre><p>互联网精神其中最重要的就是分享，基于分享，你可以享受到社会化及互联网给你带来的种种便利和好处，你分享了一个知识，你就成为了互联网中的一个点，这个点的大小由你自己来决定，互联网的大潮会将你的这个点推送到它所能触及的每个角落，让需要的人得到，同时，你的这个点也会继续扩大，连接到整个网络，这个点有可能连接成一张网，而你就是这张网的中心。</p>
<h4 id="6-帮你找到志同道合的人"><a href="#6-帮你找到志同道合的人" class="headerlink" title="6. 帮你找到志同道合的人"></a>6. 帮你找到志同道合的人</h4><p>在微博，在朋友圈，你可能找不到跟你志同道合的人，而在博客，你可以通过看他的几篇文章就迅速地理解认同这个人，即使你没有见过这个人，但你也可以通过这种关联来相互学习。</p>
<p>如果你在一个领域有相当的了解，你将这些内容发在网络上，网络上跟你志趣相投的人也会被你吸引过来，根据吸引力法则，你是怎样的人你就被怎么样的人吸引，这就是博客所能赋予你的魅力。</p>
<pre><code>即使博客没有被他人关注，我们依然可以找到同好，你可以自己将博文转载到其他站点，人们会通过搜索引擎找到你，有邮件、微博等工具，我们不乏与他人交流的途径。by Gabriel Weinberg《Why I blog》
</code></pre><h4 id="7-记录成长"><a href="#7-记录成长" class="headerlink" title="7. 记录成长"></a>7. 记录成长</h4><p>隔一段时间，你再回头看你写的博客，你会发现自己正在通过这样的方式在不断的成长，这种成长在自己眼里是一种财富，在别人眼里是一张地图，你得到了收获，不断修正自己的错误，别人得到了指引，避免走弯路。</p>
<p>更多的情况是当你回望自己的时候你会发现自己是一个傻逼，so what，that is what I am！</p>
<h4 id="8-培养持续做一件事情的能力"><a href="#8-培养持续做一件事情的能力" class="headerlink" title="8. 培养持续做一件事情的能力"></a>8. 培养持续做一件事情的能力</h4><p>开始是坚持，后来是习惯，接着就是喜欢。以后当有人对你说，「你写那么多有用的东西，你真的很厉害啊！」你可以笑而不语，也可以大声说道：「你妹，你不知道我开始的时候多么痛苦！」</p>
<p>让你长久地去跑步，你可能做不到；让你每个月看一本书，你也可能做不到；但让你持续地写一个博客，你可以做得到。</p>
<p>你不相信？你不试试你怎么知道？</p>
<p>默默地持续做一件事是一种难得的能力，也是一种难得的品质。</p>
<h4 id="9-讨论反思"><a href="#9-讨论反思" class="headerlink" title="9. 讨论反思"></a>9. 讨论反思</h4><p>每人都会有思维的盲点，就好像这篇文章一样，可能你觉得我可能说得不对，你可以反驳我，我欢迎这种讨论，因为讨论的过程中会产生各种的思维的碰撞，这种碰撞会让你反思，也会激发出你新的灵感，这种讨论反思给自己的带来巨大的受益。</p>
<p>互联网给你的反馈就是让你承受更多，接受更多，成为一个更好的人。</p>
<h4 id="10-搜寻到你意想不到东西"><a href="#10-搜寻到你意想不到东西" class="headerlink" title="10. 搜寻到你意想不到东西"></a>10. 搜寻到你意想不到东西</h4><p>世界不止是你的家，你的公司，你的朋友圈，你应该去发现一个更大的世界，通过写博客，你会知道世界上还有很多人像你一样在写博客，这些人和知识正在世界的某个角落在等着你。</p>
<p>在写这篇文章的过程中，我才知道了Gabriel Weinberg，我才要将阳志平的博客重读一遍。写的过程会让你有很多新的发现，这些新的发现都值得你去再写下来，总结分享出去。</p>
<h4 id="11-一个人在做一件属于自己的事"><a href="#11-一个人在做一件属于自己的事" class="headerlink" title="11. 一个人在做一件属于自己的事"></a>11. 一个人在做一件属于自己的事</h4><p>很多你认为自己很牛逼的事情都是自己一个人做出来。</p>
<p>别人在刷微博，你在看书，别人在看穿越剧，你在学英文，别人在去唱K，你在写个人总结。吃饭也要找同伴，出游要找同伴，看电影要找同伴，你上一次一个人在做一件属于自己的事是在什么时候？</p>
<pre><code>如果你想要清晰地思考，就必须远离人群。但是走得越远，你的处境就会越困难，收到的阻力也会越大。因为你没有迎合社会习俗，而是一步步地与它背道而驰。如果自己就是潮水的一部分 ，怎么能看见潮流的方向呢？你只能永远保持质疑，问自己，什么话是我不能说的？为什么？——Paul Graham《不能说的话》
</code></pre><h4 id="12-互联网的身份识别"><a href="#12-互联网的身份识别" class="headerlink" title="12. 互联网的身份识别"></a>12. 互联网的身份识别</h4><pre><code>一个长期的价值博客是一份很好的简历。这里的“简历”并非是狭义上的求职简历，毕竟现在还没有到价值博客的时代，很多人写博客都是到处转载或者干脆碎碎念，正因此面试官未必拿个人博客当成了解一个人的更可靠窗口。这里的“简历”是指一个让别人了解自己的窗口，虽然我们未必做得到像罗永浩、Keso这样的博客，个人的影响力已经足以支撑出一份事业（牛博和5gme），但至少你会因此而结识更多的人，你的博客价值越高，你结识的人就越牛，跟牛人交流又会让你的眼界得到极大的开阔，打开一扇又一扇你原本不知道的门，于是你就变得更牛… 这是一个良性循环。by 刘未鹏
</code></pre><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>你可能想不到在白纸的左边（不值得写博客的原因）写什么了，想不到写个「博客时代已经过去」或者「我没有时间」也可以，但与此同时，你也可以用那些时间去思考一下「怎么做到长期写一个价值博客」。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kingzeus.github.io/2015/11/04/android-log-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kingzeus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xqfqq.com1.z0.glb.clouddn.com/blog_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="游戏 生活">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/11/04/android-log-practice/" itemprop="url">Android 日志的优化实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-11-04T17:16:19+08:00">2015-11-04</time>
            

            
            
              
                
              
            

            
              
              <span class="post-meta-divider">|</span>
              

              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2016-03-30T17:16:19+08:00">2016-03-30</time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">6k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">0:06</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>最后更新: 2016-03-30</li>
<li>修改记录:<ul>
<li>2015-11-04 初稿</li>
<li>2015-11-10 增加日志需求</li>
<li>2015-11-14 增加实现细节</li>
<li>2016-03-30 图片本地化</li>
</ul>
</li>
</ul>
<h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h2><p>在日常的 Android 开发中，日志打印是一项必不可少的操作，我们通过分析打印的日志可以分析程序的运行数据和情况。本文主要介绍了如何更好的使用日志。先来介绍下相关的原理，然后来说说怎么优化开发体验。</p>
<h2 id="2-哪些形式"><a href="#2-哪些形式" class="headerlink" title="2. 哪些形式"></a>2. 哪些形式</h2><ul>
<li><p>System.out.println<br>  这是标准的Java输出方法，相信很多公司都不提倡使用，这里进行列举，目的是为了提醒大家不用。</p>
</li>
<li><p>Android Log<br>  Android 自身提供了一个日志工具类，那就是 <code>android.util.Log</code>。使用很简单，如下：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Log.i(LOGTAG, <span class="string">"onCreate"</span>);</div></pre></td></tr></table></figure>
<p>我们在调试的时候经常会输出这行代码，这个方法有两个参数，一个是TAG，一个是真正要输出的内容。</p>
<h2 id="3-TAG-的选取"><a href="#3-TAG-的选取" class="headerlink" title="3. TAG 的选取"></a>3. TAG 的选取</h2><p>TAG 选择虽然没有强制要求，一般来说只要是个字符串就行，但是好的 TAG 策略，可以提高开发体验。</p>
<h3 id="3-1-选用人名"><a href="#3-1-选用人名" class="headerlink" title="3.1 选用人名"></a>3.1 选用人名</h3><p>很多人都曾采用人名的形式，比如:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Log.i(<span class="string">"lilei"</span>, <span class="string">"onCreate"</span>);</div></pre></td></tr></table></figure>
<p>这样做的目标一是为了过滤方便，当一个人在写一个模块多个文件时，使用这个形式，过滤起来很容易帮助理解程序的执行情况。另外的目的就是为了表明日志周围代码的作者姓甚名谁。</p>
<p>然而，我却不推荐这种人名作为TAG的形式。原因如下：</p>
<ul>
<li>以人名作为关键字过滤，不易确定产生日志的类文件</li>
<li>随着某个人模块实现的增加，过滤人名易产生来自其他模块的干扰信息。</li>
</ul>
<h3 id="3-2-动态选取"><a href="#3-2-动态选取" class="headerlink" title="3.2 动态选取"></a>3.2 动态选取</h3><p>还有一种选取方式，就是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOGTAG = Settings.class.getSimpleName();</div></pre></td></tr></table></figure>
<p>这样使用，得到的 <code>LOGTAG</code> 的值就是 <code>Settings</code>。这么做，开发版使用的时候非常方便；但是当应用打包发布时，<code>Settings</code> 这个类进行了混淆之后，类名变成了类似 a,b,c 这样的名称，<code>LOGTAG</code> 则不再是 <code>Settings</code> 这个值了。这样可能造成的问题就是，内部混淆有日志的包，我们无法再通过过滤 <code>Settings</code> 来得到相应的信息。</p>
<h3 id="3-3-静态的-tag"><a href="#3-3-静态的-tag" class="headerlink" title="3.3 静态的 tag"></a>3.3 静态的 tag</h3><p>一般比较推荐的形式就是以字符串字面量形式去设置 LOGTAG。如下，在<code>Settings</code>类中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOGTAG = <span class="string">"Settings"</span>;</div></pre></td></tr></table></figure>
<h2 id="4-屏蔽日志输出"><a href="#4-屏蔽日志输出" class="headerlink" title="4. 屏蔽日志输出"></a>4. 屏蔽日志输出</h2><p>主要是通过两种方式实现的，一个是在编译期时候屏蔽；一个是在运行时中处理。</p>
<h3 id="4-1-运行时屏蔽"><a href="#4-1-运行时屏蔽" class="headerlink" title="4.1 运行时屏蔽"></a>4.1 运行时屏蔽</h3><p>通常做法，是自定义一个类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">L</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> ENABLE_LOG = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">i</span><span class="params">(String tag, String message)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (ENABLE_LOG) &#123;</div><div class="line">            android.util.Log.i(tag, message);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过调用 L.i 来输出日志,通过修改 <code>ENABLE_LOG</code> 的值可以方便的切换是否屏蔽日志输出。</p>
<p><strong>注意</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Log.i(LOGTAG, <span class="string">"sdkVersion="</span>+getVersion());</div></pre></td></tr></table></figure>
<p>虽然可以屏蔽日志输出，但是并不会屏蔽语句中的代码 <code>getVersion</code> 执行，另外字符串的拼接也会被执行到。</p>
<h3 id="4-2-编译期屏蔽"><a href="#4-2-编译期屏蔽" class="headerlink" title="4.2 编译期屏蔽"></a>4.2 编译期屏蔽</h3><p>主要是利用 <code>Proguard</code> 在代码混淆时，去掉相关的日志代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-assumenosideeffects <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">logtest</span>.<span class="title">L</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> *** i(...);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以用同样的方式来处理原生的日志打印</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-assumenosideeffects <span class="class"><span class="keyword">class</span> <span class="title">android</span>.<span class="title">util</span>.<span class="title">Log</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> *** d(...);</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> *** e(...);</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> *** i(...);</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> *** v(...);</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> *** println(...);</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> *** w(...);</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> *** wtf(...);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面来个栗子,看看反编译的出来的代码:</p>
<p>先来个测试的代码，其他无关部分都先忽略掉：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOGTAG = <span class="string">"MainActivity"</span> ;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        dumpDebugInfo();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dumpDebugInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        Locale defaultLocale = Locale.getDefault();</div><div class="line">        Log.i(LOGTAG, <span class="string">"sdkVersion="</span> + Build.VERSION.SDK_INT + <span class="string">"; Locale="</span> + defaultLocale);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后使用 <code>proguard</code> 的配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-assumenosideeffects <span class="class"><span class="keyword">class</span> <span class="title">android</span>.<span class="title">util</span>.<span class="title">Log</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> *** d(...);</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> *** i(...);</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> *** v(...);</div><div class="line">&#125;</div><div class="line"></div><div class="line">-assumenosideeffects <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">droidyue</span>.<span class="title">logdemo</span>.<span class="title">DroidLog</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> *** i(...);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>生成 apk 之后,反编译,得到 smali 源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"># virtual methods</div><div class="line">.<span class="function">method <span class="keyword">protected</span> <span class="title">onCreate</span><span class="params">(Landroid/os/Bundle;)</span>V</span></div><div class="line"><span class="function">    .locals 3</span></div><div class="line"><span class="function"></span></div><div class="line"><span class="function">    invoke-<span class="keyword">super</span> </span>&#123;p0, p1&#125;, Landroid/app/Activity;-&gt;onCreate(Landroid/os/Bundle;)V</div><div class="line"></div><div class="line">    <span class="keyword">const</span> v0, <span class="number">0x7f030017</span></div><div class="line"></div><div class="line">    invoke-virtual &#123;p0, v0&#125;, Lcom/test/logdemo/MainActivity;-&gt;setContentView(I)V</div><div class="line"></div><div class="line">    invoke-<span class="keyword">static</span> &#123;&#125;, Ljava/util/Locale;-&gt;getDefault()Ljava/util/Locale;</div><div class="line"></div><div class="line">    move-result-object v0</div><div class="line"></div><div class="line">    <span class="keyword">new</span>-instance v1, Ljava/lang/StringBuilder;</div><div class="line"></div><div class="line">    <span class="keyword">const</span>-string v2, <span class="string">"sdkVersion="</span></div><div class="line"></div><div class="line">    invoke-direct &#123;v1, v2&#125;, Ljava/lang/StringBuilder;-&gt;&lt;init&gt;(Ljava/lang/String;)V</div><div class="line"></div><div class="line">    sget v2, Landroid/os/Build$VERSION;-&gt;SDK_INT:I</div><div class="line"></div><div class="line">    invoke-virtual &#123;v1, v2&#125;, Ljava/lang/StringBuilder;-&gt;append(I)Ljava/lang/StringBuilder;</div><div class="line"></div><div class="line">    move-result-object v1</div><div class="line"></div><div class="line">    <span class="keyword">const</span>-string v2, <span class="string">"; Locale="</span></div><div class="line"></div><div class="line">    invoke-virtual &#123;v1, v2&#125;, Ljava/lang/StringBuilder;-&gt;append(Ljava/lang/String;)Ljava/lang/StringBuilder;</div><div class="line"></div><div class="line">    move-result-object v1</div><div class="line"></div><div class="line">    invoke-virtual &#123;v1, v0&#125;, Ljava/lang/StringBuilder;-&gt;append(Ljava/lang/Object;)Ljava/lang/StringBuilder;</div><div class="line"></div><div class="line">    move-result-object v0</div><div class="line"></div><div class="line">    invoke-virtual &#123;v0&#125;, Ljava/lang/StringBuilder;-&gt;toString()Ljava/lang/String;</div><div class="line"></div><div class="line">    <span class="keyword">return</span>-<span class="keyword">void</span></div><div class="line">.end method</div></pre></td></tr></table></figure>
<p>无论是运行时日志屏蔽还是编译期，message参数上发生的字符串拼接都依然存在。但是编译期屏蔽减少了方法调用（即方法进出栈操作）.</p>
<h2 id="5-优化实践"><a href="#5-优化实践" class="headerlink" title="5. 优化实践"></a>5. 优化实践</h2><p>本来文章到这里就可以结束了。介绍了原理，接下来小伙伴们就可以愉快的编码了。但是作为有追求的理想青年，我们还是可以利用 log 来提升开发体验的。</p>
<h3 id="对于一个需要重复无数遍的函数，我们需要尽可能的简化"><a href="#对于一个需要重复无数遍的函数，我们需要尽可能的简化" class="headerlink" title="对于一个需要重复无数遍的函数，我们需要尽可能的简化"></a>对于一个需要重复无数遍的函数，我们需要尽可能的简化</h3><p>在应用开发中，我们可能需要无数次的写下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Log.d(TAG, <span class="string">"This is a debug log"</span>);</div></pre></td></tr></table></figure>
<p>很多时候，我们仅需要个输出，于是就有了第一个需求，省略 TAG，或者说，我们希望有一个东西可以帮我们定义好TAG，我们只需要写正真有意义的内容就行。</p>
<p>更进一步，虽然现在 IDE 都有了代码自动提示，但是能少打几个字总是好的。我们希望 <code>L</code> 来替代 <code>Log</code><br><img src="/images/14593159827054.jpg" alt=""></p>
<h3 id="然后呢，我们希望-log-输出的更加美观。最好输出的有一个-超链接-，点击就能跳转到相应的代码中"><a href="#然后呢，我们希望-log-输出的更加美观。最好输出的有一个-超链接-，点击就能跳转到相应的代码中" class="headerlink" title="然后呢，我们希望 log 输出的更加美观。最好输出的有一个 超链接 ，点击就能跳转到相应的代码中"></a>然后呢，我们希望 log 输出的更加美观。最好输出的有一个 <code>超链接</code> ，点击就能跳转到相应的代码中</h3><p><img src="/images/14593160049267.jpg" alt=""></p>
<p> ==这个功能只支持 Android Studio，Eclipse只能输出,无法跳转==</p>
<h3 id="有时候，我们需要的只是输出一个简单的字符，有时候，我们又希望能把函数调用的堆栈也打印出来。"><a href="#有时候，我们需要的只是输出一个简单的字符，有时候，我们又希望能把函数调用的堆栈也打印出来。" class="headerlink" title="有时候，我们需要的只是输出一个简单的字符，有时候，我们又希望能把函数调用的堆栈也打印出来。"></a>有时候，我们需要的只是输出一个简单的字符，有时候，我们又希望能把函数调用的堆栈也打印出来。</h3><p><img src="/images/14593161319131.jpg" alt=""></p>
<p>或者是<br><img src="/images/14593161410375.jpg" alt=""></p>
<h3 id="最好能支持数据的可视化，而不用手动去拼接字符串或者简单的通过-Object-toString-来打印对象信息。"><a href="#最好能支持数据的可视化，而不用手动去拼接字符串或者简单的通过-Object-toString-来打印对象信息。" class="headerlink" title="最好能支持数据的可视化，而不用手动去拼接字符串或者简单的通过 Object.toString() 来打印对象信息。"></a>最好能支持数据的可视化，而不用手动去拼接字符串或者简单的通过 <code>Object.toString()</code> 来打印对象信息。</h3><ul>
<li><p>json 格式化<br><img src="/images/14593161539016.jpg" alt=""></p>
</li>
<li><p>数组等数据结构<br><img src="/images/14593161652253.jpg" alt=""></p>
</li>
</ul>
<p>对应输出<br><img src="/images/14593161747214.jpg" alt=""></p>
<ul>
<li>其他对象<br><img src="/images/14593161920970.jpg" alt=""></li>
</ul>
<h3 id="哦，还有。加个能控制-log的开关-另外能够方便的定制-log-的输出-比如输出到文件或者回传服务器"><a href="#哦，还有。加个能控制-log的开关-另外能够方便的定制-log-的输出-比如输出到文件或者回传服务器" class="headerlink" title="哦，还有。加个能控制 log的开关,另外能够方便的定制 log 的输出,比如输出到文件或者回传服务器"></a>哦，还有。加个能控制 log的开关,另外能够方便的定制 log 的输出,比如输出到文件或者回传服务器</h3><h2 id="6-实现"><a href="#6-实现" class="headerlink" title="6. 实现"></a>6. 实现</h2><p>上面的需求实现的难度并不是很大，这里就大致介绍下实现的思路。</p>
<p><img src="/images/14593162006800.jpg" alt=""></p>
<h3 id="获取当前类名"><a href="#获取当前类名" class="headerlink" title="获取当前类名"></a>获取当前类名</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getClassName</span><span class="params">()</span> </span>&#123;        String result;        StackTraceElement thisMethodStack = (<span class="keyword">new</span> Exception()).getStackTrace()[<span class="number">2</span>];        result = thisMethodStack.getClassName();        <span class="keyword">int</span> lastIndex = result.lastIndexOf(<span class="string">"."</span>);        result = result.substring(lastIndex + <span class="number">1</span>, result.length());        <span class="comment">//如果调用位置在匿名内部类的话，就会产生类似于 MainActivity$3 这样的TAG</span>        <span class="comment">//可以把$后面的部分去掉</span>        <span class="keyword">int</span> i = result.indexOf(<span class="string">"$"</span>);        <span class="keyword">return</span> i == -<span class="number">1</span> ? result : result.substring(<span class="number">0</span>, i);    &#125;</div></pre></td></tr></table></figure>
<h3 id="输出函数文件信息"><a href="#输出函数文件信息" class="headerlink" title="输出函数文件信息"></a>输出函数文件信息</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**     * log这个方法就可以显示超链     */</span>    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">callMethodAndLine</span><span class="params">()</span> </span>&#123;        String result = <span class="string">"at "</span>;        StackTraceElement thisMethodStack = (<span class="keyword">new</span> Exception()).getStackTrace()[<span class="number">1</span>];        result += thisMethodStack.getClassName()+ <span class="string">"."</span>;        result += thisMethodStack.getMethodName();        result += <span class="string">"("</span> + thisMethodStack.getFileName();        result += <span class="string">":"</span> + thisMethodStack.getLineNumber() + <span class="string">")  "</span>;        <span class="keyword">return</span> result;    &#125;</div></pre></td></tr></table></figure>
<h3 id="数据可视化实现"><a href="#数据可视化实现" class="headerlink" title="数据可视化实现"></a>数据可视化实现</h3><ul>
<li><code>array</code>,<code>map</code>,<code>set</code> 等容器可以通过遍历显示</li>
<li><code>Object</code> 可以通过反射方式,拿到变量以及变量的类型</li>
<li><code>xml</code>,<code>json</code> 可以通过自定义格式化来实现</li>
</ul>
<h2 id="7-后记"><a href="#7-后记" class="headerlink" title="7. 后记"></a>7. 后记</h2><p> 通过这篇文章，给大家介绍了一个日志输出优化的过程。通过实践，说明一个最简单的日志输出都是有很多可以优化的地方；有时候，一些小小的改造，可以极大的提升开发的体验。</p>
<p> 最后的最后，你可能不太喜欢这样的日志输出。没关系，相信我们的最终目的是一致的，就是让开发越来越便捷，代码越来越优雅~</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://kingzeus.github.io/2014/01/19/mac-ramdisk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kingzeus">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xqfqq.com1.z0.glb.clouddn.com/blog_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="游戏 生活">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/01/19/mac-ramdisk/" itemprop="url">【无所不能的脚本】mac下的ramdisk</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-01-19T11:26:38+08:00">2014-01-19</time>
            

            
            
              
                
              
            

            
              
              <span class="post-meta-divider">|</span>
              

              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2016-03-30T11:26:38+08:00">2016-03-30</time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/osx/" itemprop="url" rel="index"><span itemprop="name">osx</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">3.9k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">0:04</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>最后更新: 2016-03-30</li>
<li>修改记录:<ul>
<li>2014-01-19 初稿，发布于 51cto</li>
<li>2015-01-21 增加大小保护，发布于 51cto</li>
<li>2016-03-30 合并之前的文章</li>
</ul>
</li>
</ul>
<h2 id="0-前言"><a href="#0-前言" class="headerlink" title="0. 前言"></a>0. 前言</h2><p>现在流行苹果，mbp，mba，iphone，ipad，……关键是windows上各种流氓软件越来越多，加上工作需要，于是转投了 mac。好吧，入手的 mbp 看起来很美，实际上各种卡，整天看到小菊花转啊转。好吧，屌丝买不起高配，用的是最低端的，说起来，满满的都是泪，但是生活还得继续，只能自己想办法了。</p>
<p>优化第一步，加内存。不要问我为什么能加，老机器了，不说了，满满的都是泪。有钱的孩纸买机器的时候就加内存吧，普罗大众还是不要自己折腾吧。当然大神们可以自己动手换内存，这个也不说了。</p>
<p>第二步，上 SSD 吧。这个真心不错，但是好东西不便宜啊，能把ssd和hdd一样随便放东西的同学，略过这篇文章吧。我的mbp是用来开发的，乱七八糟的东西占了好大的空间，于是ssd就得不停的整理空间，删除缓存文件，就为了那几个 G 的容量。最近，还碰到过因为 ssd 剩余空间是0，无法开机的悲剧。</p>
<p>神圣的红领巾一直在前面引领着我们，生命不息，折腾不止……重点来了，我们可以利用内存来提速啊，这个在windows上已经烂大街了，不就是ramdisk么。拿出谷哥度娘，一番OOXX之后，发现没啥好用，倒是发现mac本身就能实现。身为屌丝IT男，必须自己折腾了。当然，折腾这个的前提是你的内存足够大。</p>
<p>@#！@￥#￥@%#￥%（一星期过去了……………………）</p>
<h2 id="1-实现"><a href="#1-实现" class="headerlink" title="1. 实现"></a>1. 实现</h2><h3 id="1-ramdisk"><a href="#1-ramdisk" class="headerlink" title="1. ramdisk"></a>1. ramdisk</h3><p>不说折腾的过程了，直接上结果吧。<br>先来说下大致的工作流程：</p>
<ol>
<li>开机的时候，自动调用脚本创建内存盘，然后载入需要的数据。</li>
<li>关机的时候，自动调用脚本把内存盘数据回写硬盘，然后执行关机。</li>
</ol>
<p>不复杂哈，一说就明白了吧，下面来点复杂的：</p>
<ol>
<li><p>先来说，怎么再开机的时候运行脚本。<br> 先在你顺眼的地方建个目录，用来作为ramdisk的脚本和备份数据的工作目录。<img src="images/14593149822393.jpg" alt=""></p>
<p> 我的目录，在/etc/下面建了个ramdisk的目录，小伙伴照着做的话，注意下权限。</p>
</li>
<li><p>接下来，就创建一个 login.sh 的脚本，用来再开机的时候自动运行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line"> </div><div class="line"># 设置内存盘的名称</div><div class="line">DISK_NAME=RamDisk</div><div class="line">MOUNT_PATH=/Volumes/$DISK_NAME</div><div class="line"># 设置备份文件的保存路径, 注意修改下面路径中的用户名称</div><div class="line">BAK_PATH=/etc/ramdisk/$DISK_NAME.tar.gz</div><div class="line"># 设置分配给内存盘的空间大小(MB)</div><div class="line">DISK_SPACE=1024</div><div class="line"> </div><div class="line">if [ ! -e $MOUNT_PATH ]; then</div><div class="line">	diskutil erasevolume HFS+ $DISK_NAME `hdiutil attach -nomount ram://$(($DISK_SPACE*1024*2))`</div><div class="line">fi</div><div class="line">#  隐藏分区</div><div class="line">chflags hidden $MOUNT_PATH</div><div class="line"></div><div class="line">if [ -s $BAK_PATH ]; then</div><div class="line">    tar -zxf $BAK_PATH -C $MOUNT_PATH</div><div class="line">fi</div></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>* ==DISK_NAME== 用来指定内存盘的名字，随便改
* ==DISK_SPACE== 用来指定内存盘大小，这是上限值，一般情况下使用多少占多少的内存，所以放心使用吧
* ==BAK_PATH== 用来指定内存盘的保存路径
</code></pre><ol>
<li><p>再创建一个logout.sh，用来在关机的时候调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line"> </div><div class="line">DISK_NAME=RamDisk</div><div class="line">MOUNT_PATH=/Volumes/$DISK_NAME</div><div class="line">WORK_PATH=/etc/ramdisk</div><div class="line">BAK_PATH=$WORK_PATH/$DISK_NAME.tar.gz</div><div class="line">LISTFILE=$WORK_PATH/list</div><div class="line"></div><div class="line"></div><div class="line">if [ -e $MOUNT_PATH ] ; then</div><div class="line">	cd $MOUNT_PATH</div><div class="line">	tar --exclude-from $LISTFILE -czf $BAK_PATH .</div><div class="line">fi</div></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>* ==DISK_NAME== 用来指定内存盘的名字，要和之前的脚本一致
* ==BAK_PATH== 用来指定内存盘的保存路径，一样要和上面的一致
* ==LISTFILE== 忽略的文件列表
</code></pre><h3 id="1-2-运行"><a href="#1-2-运行" class="headerlink" title="1.2 运行"></a>1.2 运行</h3><p>ramdisk搞定，然后呢？当然是怎么使用了。</p>
<p>先在终端里面把 <code>login.sh</code>跑起来啊，跑起来。权限有问题的，可以用sudo方式。然后呢，去finder里面看看吧！</p>
<p>什么都没有？为什么？好吧，其实再脚本里面我把内存盘隐藏了，为啥要加这么帅的操作呢？里面有没有日本的爱情动画片。因为很多小伙伴都手贱，把ramdisk卸载了之后，就会各种悲剧了。所以，事先隐藏了之后，麻麻就再也不用担心了。</p>
<p>那怎么访问呢？有个神奇的办法，在finder的菜单里面找到前往，选择前往文件夹<br><img src="images/14593152549913.jpg" alt=""><br> 然后，输入内存盘的加载路径，也就是脚本里面的<code>MOUNT_PATH</code>，接下来就是见证奇迹的时候了……<br> <img src="images/14593153601092.jpg" alt=""></p>
<h3 id="1-3-使用"><a href="#1-3-使用" class="headerlink" title="1.3 使用"></a>1.3 使用</h3><p>有了内存盘，里面放什么呢？爱情动作片就算了，可以把cache放在里面，这样可以加速运行速度，也可以把经常需要频繁操作的目录放进去，比如chrome的配置啊什么的……</p>
<h4 id="1-3-1-cache-目录"><a href="#1-3-1-cache-目录" class="headerlink" title="1.3.1 cache 目录"></a>1.3.1 cache 目录</h4><p>先来处理cache：</p>
<ul>
<li>先把系统的cache目录移动到内存盘上去</li>
<li>然后通过符号链接把内存盘上的目录映射回原来的目录<br><img src="/images/14593153742813.jpg" alt=""><br>对应了<br><img src="/images/14593153824224.jpg" alt=""></li>
</ul>
<p>不会的，给个脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span>!/bin/sh</div><div class="line"></div><div class="line"><span class="meta">#</span> 设置内存盘的名称</div><div class="line">DISK_NAME=RamDisk</div><div class="line">MOUNT_PATH=/Volumes/$DISK_NAME</div><div class="line"></div><div class="line"><span class="meta">#</span>Caches =》 ~/Library/Caches</div><div class="line">mv ~/Library/Caches $MOUNT_PATH</div><div class="line">ln -s /$MOUNT_PATH/Caches ~/Library/Caches</div></pre></td></tr></table></figure>
<h4 id="1-3-2-chrome-目录"><a href="#1-3-2-chrome-目录" class="headerlink" title="1.3.2 chrome 目录"></a>1.3.2 chrome 目录</h4><p>同样处理下<br><img src="/images/14593154100049.jpg" alt=""><br>对应的是<br><img src="/images/14593154195716.jpg" alt=""></p>
<h4 id="1-3-3-其他目录"><a href="#1-3-3-其他目录" class="headerlink" title="1.3.3 其他目录"></a>1.3.3 其他目录</h4><p>照着上面的方法,可以把你想要搬的目录全部移动到 ramdisk 上去</p>
<p>再打开内存盘就能看到目录了<img src="/images/14593154301396.jpg" alt=""></p>
<h3 id="1-4-配置自动运行"><a href="#1-4-配置自动运行" class="headerlink" title="1.4 配置自动运行"></a>1.4 配置自动运行</h3><p>脚本有了，关键是要能随着系统启动、关闭，自动运行起来。</p>
<p>在终端里面运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">defaults write com.apple.loginwindow LoginHook /etc/ramdisk/login.sh</div><div class="line">defaults write com.apple.loginwindow LogoutHook /etc/ramdisk/logout.sh</div></pre></td></tr></table></figure>
<p>可以通过</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">defaults read com.apple.loginwindow</div></pre></td></tr></table></figure>
<p>来检查设置是否成功。</p>
<p>最后，重启机器看看。</p>
<h2 id="2-脚本高级配置"><a href="#2-脚本高级配置" class="headerlink" title="2. 脚本高级配置"></a>2. 脚本高级配置</h2><p>有了ramdisk以后，mac是不是不一样了？没感觉，好吧，ramdisk不是救世主，不能减少pm2.5的，只能提高部分文件的io效率，要想那啥的，换机器+ssd才是正道。</p>
<p>用了一阵子之后，发现ramdisk越来越大了没有？赶紧看下，果然啊，cache目录占了好多容量。</p>
<p>很大有没有，用软件清理么？不符合懒人哲学啊。作为有追求的屌丝it男，必须用脚本。</p>
<p>￥%￥#……%……&amp;%……（再次省略无数的探索过程……）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span>!/bin/sh</div><div class="line"> </div><div class="line">DISK_NAME=RamDisk</div><div class="line">MOUNT_PATH=/Volumes/$DISK_NAME</div><div class="line">WORK_PATH=/etc/ramdisk</div><div class="line">BAK_PATH=$WORK_PATH/$DISK_NAME.tar.gz</div><div class="line">LISTFILE=$WORK_PATH/list</div><div class="line"><span class="meta">#</span>设置最大的cache大小(M)</div><div class="line">MAX_CACHE_SIZE=50</div><div class="line"></div><div class="line"><span class="meta">#</span> </div><div class="line">cd $MOUNT_PATH</div><div class="line"></div><div class="line"></div><div class="line">declare -a fa</div><div class="line">i=0</div><div class="line"><span class="meta">#</span> Caches 目录存在</div><div class="line">if [ -d "$myPath"]; then </div><div class="line">	for file in $(du -s Caches/* | sort -n)</div><div class="line">	do</div><div class="line"><span class="meta">	  fa[$</span>i]=$file</div><div class="line">	  let i=i+1</div><div class="line">	done</div><div class="line">fi</div><div class="line"></div><div class="line"></div><div class="line">size=$((i/2))</div><div class="line">echo "Caches file number:"$size</div><div class="line"></div><div class="line">cd $WORK_PATH</div><div class="line">echo ".?*"&gt;$LISTFILE</div><div class="line">for((i=0;i&lt;$size;i++))</div><div class="line">do</div><div class="line">  if (($&#123;fa[$((i*2))]&#125;&lt;(($MAX_CACHE_SIZE*1024*2)) ));then</div><div class="line">  	echo "add:"$&#123;fa[$((i*2+1))]&#125;</div><div class="line">  else</div><div class="line">  	echo $&#123;fa[$((i*2+1))]&#125;&gt;&gt;$LISTFILE</div><div class="line">  fi</div><div class="line">  </div><div class="line">done</div><div class="line"></div><div class="line"></div><div class="line">if [ -e $MOUNT_PATH ] ; then</div><div class="line">	cd $MOUNT_PATH</div><div class="line">	tar --exclude-from $LISTFILE -czf $BAK_PATH .</div><div class="line">fi</div></pre></td></tr></table></figure>
<p>简单说明下，就是每次关机会把<code>cache</code>目录下超过50M的目录直接清掉。</p>
<ul>
<li>==MAX_CACHE_SIZE== 可以指定最大的cache目录大小</li>
</ul>
<p>重启机器，再来看下</p>
<p>于是世界终于和平了…………</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://7xqfqq.com1.z0.glb.clouddn.com/blog_avatar.jpg"
                alt="kingzeus" />
            
              <p class="site-author-name" itemprop="name">kingzeus</p>
              <p class="site-description motion-element" itemprop="description">游戏是可以SL的人生<br />人生是没有NG的游戏</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/kingzeus" target="_blank" title="github"><i class="fa fa-fw fa-globe"></i>github</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://www.weibo.com/2405704" target="_blank" title="weibo"><i class="fa fa-fw fa-globe"></i>weibo</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/fan-ye-fei" target="_blank" title="zhihu"><i class="fa fa-fw fa-globe"></i>zhihu</a>
                  
                </span>
              
            </div>
          

          
          
            <div class="cc-license motion-element" itemprop="license">
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
                <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
              </a>
            </div>
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kingzeus</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">24k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点总阅读时长">0:24</span>
  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.0.4</div>




        





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=55046364";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.4"></script>



  



	





  





  






<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    






  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.0.4"></script>



  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

</body>
</html>
